{{ extend "layout.html"}}

<style type="text/css">
.detailBox {
  width: 100%;
  margin: 0%;
}

.commentBox {
  padding: 10px;
}

.commentBox .form-group:first-child,
.actionBox .form-group:first-child {
  width: 80%;
}

.commentBox .form-group:nth-child(2),
.actionBox .form-group:nth-child(2) {
  width: 18%;
}

.actionBox .form-group * {
  width: 100%;
}


.commentList {
  padding: 0;
  list-style: none;
  max-height: 200px;
  overflow: auto;
}

.commentList li {
  margin: 0;
  margin-top: 10px;
}

.commentList li > div {
  display: table-cell;
  margin-bottom: 3%;
}

.commenterImage {
  width: 30px;
  margin-right: 5px;
  height: 100%;
  float: left;
}

.commenterImage img {
  width: 100%;
  border-radius: 20%;
}

.commentText p {
  margin: 0;
}

.sub-text {
  color: #aaa;
  font-family: verdana;
  font-size: 11px;
}

.actionBox {
  /* border-top: 1px dotted #bbb; */
    padding: 2%;
    padding-left: 5%;
    padding-right: 5%;
    padding-bottom: 5%
}


.post-owner-Image {
  width: 60px;
  margin-right: 5px;
  height: 100%;
  float: left;
}


.post-owner-Image img {
  width: 100%;
  border-radius: 10%;
}

@media (min-width: 600px) {
    .left-pannel-fixed {
        position: fixed;
        width: 28%;
    }
}

.ErrorMessage{
  color: RED;
  font-style: italic;
}
.ErrorHide{
  display: none;
}

.date-time-style{
  font-size: 11px;
}

#list-galleris{
  height: 130px;
  overflow-y: auto;
}

.glyphicon{
  cursor: pointer;
}
</style>

<script type="text/javascript">
  function isTheFormValid(e) {
    if( $("#new_status").val().trim() == "" ){
      $("#StatusError").removeClass("ErrorHide")
      $("#new_status").focus()
      return false;
    }
    $("#StatusError").addClass("ErrorHide")
    return true;
  }

  function isCommentValid(e) {
    comment_box = $(e).parent().prev();
    error_msg = $(e).parent().parent().parent().next();

    if( comment_box.val().trim() == "" ){
      $(error_msg).removeClass("ErrorHide")
      $(error_msg).focus()
      return false;
    }
    $(error_msg).addClass("ErrorHide")
    return true;
  }
</script>

<!--              Left pannel           -->
<div class="col-md-4 col-sm-3">
	<div class="left-pannel-fixed " > 
    <div class="well">
        <!-- container for updating status -->
        <form  action="{{ =URL('post_status') }}" method="post" 
        		class="form-horizontal" role="form">
            <h4>What's New</h4>
            	<div class="form-group" style="padding:14px;">
                	<textarea name="new_status" id="new_status"
                      class="form-control" placeholder="Update your status"></textarea>
                  <span id="StatusError" class="ErrorMessage ErrorHide">Status can not be empty.</span>
              	</div>
              	<button class="btn btn-success pull-right" 
                      onclick="return isTheFormValid()" type="submit">Post</button>
              	<ul class="list-inline" ><li>
              	Share with {{ = form.custom.widget.shared_with }}</li></ul>
        </form>
      </div>
      <div class="well" > 
          <!-- container for listing the gallaries -->
          <form  action="{{ =URL('post_status') }}" method="post" 
              class="form-horizontal" role="form">
                <h4>Gallery</h4>
                {{ if impersonation == "OFF": }}
                <a  name="create_new_gallery"
                    onclick="ajax( '{{=URL('user','new_gallery')}}', ['create_new_gallery'], 'middle-pannel' )">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true">
                  </span>
                </a>
                {{ pass }}

                {{ =LOAD('user', 'list_galleries.html', \
                        args=[auth.user.id if request.args(0)==None else request.args(0) ], \
                        ajax=True, target="list-galleris" ) }}
        </form>
      </div>
    </div>
</div>


<div class="col-md-5 col-sm-6 " id="middle-pannel">
	{{ for post in post_cleaned:}}
      <div class="panel panel-default">
           <div class="panel-heading">
              <a href="{{=URL("user", "home")}}/{{=thePost_is_created_by_userId[post.id]}}">
                <div class="post-owner-Image">                
                  <img src="{{ =URL('download', args=profile_picture_of_post_owner[post.modified_by]) }}"
                    onerror="this.src = '{{=URL('getconnected','static','images')}}/no-image.png';">
                </div>
              </a>
              <a href="#" class="pull-right date-time-style">{{=post.created_on.strftime("%d %b %Y, %I:%m %p")}}</a> 
              <a href="{{=URL("user", "home")}}/{{=thePost_is_created_by_userId[post.id]}}">
                <h4>{{=post.created_by}}</h4>
              </a>
           </div>
        <div class="panel-body">
              <div class="clearfix"></div>
              {{=post.data_content}}
              {{ if post.shared_with != "" : }}
                  <hr>
              {{ pass }}
              
                <ul class="list-unstyled">
                  <li>
                    {{ if post.shared_with != "" : }}
                      <span style="color: darkgrey;"> with</span> 
                          <a href="{{=URL("user", "home")}}/{{=shared_thePost_with_userId[post.id]}}">
                            {{=post.shared_with}}
                          </a>
                    {{ pass }}
                    {{ if post.shared_with != "" and post.id in count_of_likes_for_post and count_of_likes_for_post[post.id] > 0: }}
                      <span style="color: darkgrey; margin: 0px 8px;"> | </span>
                    {{ pass }}
                    {{ if post.id in count_of_likes_for_post and count_of_likes_for_post[post.id] > 0: }}
                        <span style="color: darkgrey;"
                                title="{{=first_two_likes_by[post.id]}}">
                          {{ if count_of_likes_for_post[post.id] == 1: }}
                            1 person liked it.
                          {{ else: }}
                            {{ =count_of_likes_for_post[post.id] }} people liked it
                          {{ pass }}
                        </span>
                  </li>
                </ul>
                <hr/>
              {{ pass }}
                          
              <div class="detailBox">
                  <div class="actionBox">
                      <ul class="commentList">
                        {{ for comment in comments_for_post_dict[post.id]: }}
                          <li>
                              <div class="commenterImage">
                                <!-- <img src="http://lorempixel.com/50/50/people/6" /> -->
                                <img src="{{ =URL('download', args=commenter_profile_pic[comment.created_by] ) }}"
                                      onerror="this.src = '{{=URL('getconnected','static','images')}}/no-image.png';"/>
                              </div>
                              <div class="commentText">
                                  <p class="">{{=comment.data_content}}</p> 
                                  <span class="date sub-text">
                                    on {{=comment.created_on.strftime("%d %b %Y, %I:%m %p")}}
                                  </span>
                              </div>
                          </li>
                          {{ pass }}
                      </ul>
                      <form action="{{ = URL('post_comment_like') }}/{{=loggedin_User_id}}" method="post"
                            class="form-inline" role="form" name="comment_like_form" >
                          <div class="input-group" style="width:100%">
                            <input type="hidden" name="post_id" value="{{=post.id}}">
                            <input name="new_comment" type="textbox" placeholder="Enter your comment" 
                                      class="form-control">
                            <span class="input-group-btn">
                              <button class="btn btn-default" type="submit" name="comment_btn" 
                                  onClick="return isCommentValid(this);" value="Commented">
                                      <span class="glyphicon glyphicon-chevron-right"></span>
                              </button>
                              {{ if post.id in id_of_posts_liked_by_me: }}
                                  <button class="btn btn-default" name="like_btn" value="liked" 
                                          type="submit">
                                        <span style="color:#337AB7" class="glyphicon glyphicon-thumbs-up"></span>
                                  </button>
                              {{ else: }}
                                  <button class="btn btn-default" name="like_btn" value="liked" 
                                          type="submit">
                                        <span class="glyphicon glyphicon-thumbs-up"></span>
                                  </button>
                              {{ pass }}
                            </span>
                          </div>
                      </form>
                      <span id="CommentError" class="ErrorMessage ErrorHide ">Comment can not be empty.</span>
                  </div>
              </div>
            </div>
        </div>
  {{ pass }}
</div>


<div class="col-md-3 col-sm-3 ">
  <div class="left-pannel-fixed " style="width: 24%;"> 
      <div class="well"  > 
          <!-- container for listing the gallaries -->
          <form  action="{{ =URL('post_status') }}" method="post" 
              class="form-horizontal" role="form">
                <h4>
                <span class="glyphicon glyphicon-flag" style="color:#337ab7"></span>
                Notifications</h4>

                {{ =LOAD('user', 'get_notifications_list', ajax=True, target="notification-pannel" ) }} 
                
                <div id="notification-pannel"></div>
        </form>
      </div>
  </div>
</div>